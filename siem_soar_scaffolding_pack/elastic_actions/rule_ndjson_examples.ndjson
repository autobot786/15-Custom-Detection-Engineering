{"type": "security-rule", "attributes": {"name": "CDE - PowerShell Encoded Command", "description": "Detects encoded PowerShell usage (obfuscation).", "risk_score": 73, "severity": "high", "rule_type_id": "query", "index": ["logs-*", "winlogbeat-*", "endgame-*"], "query": "process.name:(powershell.exe OR pwsh.exe) AND process.command_line:(*\"-enc\"* OR *\"-encodedcommand\"* OR *\"FromBase64String\"*)", "from": "now-15m", "interval": "5m", "enabled": false, "tags": ["CDE", "attack.t1059.001"], "actions": [{"group": "default", "id": "<WEBHOOK_CONNECTOR_ID>", "action_type_id": ".webhook", "params": {"body": "{\"source\":\"elastic-security\",\"rule_name\":\"{{rule.name}}\",\"severity\":\"high\",\"timestamp\":\"{{date}}\",\"user\":\"{{context.alerts.0.user.name}}\",\"host\":\"{{context.alerts.0.host.name}}\",\"source_ip\":\"{{context.alerts.0.source.ip}}\",\"sha256\":\"{{context.alerts.0.file.hash.sha256}}\"}"}, "frequency": {"notifyWhen": "onActiveAlert", "summary": false, "throttle": null}}]}}
{"type": "security-rule", "attributes": {"name": "CDE - Cloud Storage Exfil Spike", "description": "Detects uploads to cloud storage domains (thresholding done via rule scheduling/aggregation).", "risk_score": 47, "severity": "medium", "rule_type_id": "query", "index": ["logs-*"], "query": "event.category:network AND url.domain:(drive.google.com OR dropbox.com OR box.com OR onedrive.live.com OR mega.nz)", "from": "now-15m", "interval": "5m", "enabled": false, "tags": ["CDE", "attack.t1567"], "actions": [{"group": "default", "id": "<SLACK_CONNECTOR_ID>", "action_type_id": ".slack", "params": {"message": "*Elastic Alert* {{rule.name}}: possible exfil by {{context.alerts.0.user.name}} from {{context.alerts.0.source.ip}} to {{context.alerts.0.url.domain}}"}, "frequency": {"notifyWhen": "onActiveAlert", "summary": false, "throttle": null}}]}}
